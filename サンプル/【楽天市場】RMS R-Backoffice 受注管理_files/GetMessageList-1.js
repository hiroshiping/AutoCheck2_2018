function GetMessageList(labelDialog){this.labelDialog=labelDialog}
GetMessageList.prototype={get:function(){var labelXhr=$.ajax(this.getRequest()).done(this.displayMsgList()).fail(this.displaySysErrDialog());this.labelDialog.setLabelXhr(labelXhr)},getRequest:function(){var request={};request.url="https://order.rms.rakuten.co.jp/rms/mall/order/rb/vc";request.type="GET";request.dataType="json";request.traditional=true;request.data={"__event":"MessageList","orderNumber":this.labelDialog.getOrderNumber(),"bindId":this.labelDialog.getBindId()};return request},displayMsgList:function(){var self=
this;return function(data,status,xhr){self.emptyDialog();if(data.resultCode=="E16-002"||data.resultCode=="E15-023"){self.displayErrDialog(data);return}if(data.resultCode!="N00-000"){self.processFail(data);return}self.processSucc(data)}},processSucc:function(data){this.setMsgData(data);this.set$messages();this.printMessageList()},processFail:function(data){this.setErrMsgData(data);this.set$messageList();this.printMessageList()},setErrMsgData:function(data){var nowMsgData=this.labelDialog.getMsgData();
var errMsg={};errMsg.msg=data.msg;errMsg.resultCode=data.resultCode;errMsg.unitErrors=data.unitErrors;var msgData=$.extend(true,{},nowMsgData,errMsg);this.labelDialog.setMsgData(msgData)},set$messageList:function(){var $messageList={};var data=this.labelDialog.getMsgData();var tmplOptions=this.labelDialog.getTmplOptions();try{$messageList=$.tmpl("messageList",data,tmplOptions)}catch(e){}this.labelDialog.set$messageList($messageList)},printMessageList:function(){var $messageList=this.labelDialog.get$messageList();
this.printPage($messageList)},printPage:function($page){var $Dialog=this.labelDialog.get$Dialog();$Dialog.append($page)},emptyDialog:function(){var $Dialog=this.labelDialog.get$Dialog();$Dialog.empty()},setMsgData:function(data){var nowMsgData=this.labelDialog.getMsgData();var msgData=$.extend(true,{},nowMsgData,data);this.labelDialog.setMsgData(msgData)},set$messages:function(){var $messageList={};var $messageEdit={};var data=this.labelDialog.getMsgData();var tmplOptions=this.labelDialog.getTmplOptions();
try{var obj=this.existsResultSending(data);$messageList=$.tmpl("messageList",obj,tmplOptions);$messageEdit=$.tmpl("messageEdit",data,tmplOptions);this.removeResultSending()}catch(e){}this.labelDialog.set$messageList($messageList);this.labelDialog.set$messageEdit($messageEdit)},existsResultSending:function(data){var resultSending=this.labelDialog.getResultSending();if(Object.keys(resultSending)<=0)return data;return this.mergeResultSending(data)},mergeResultSending:function(data){var resultSending=
this.labelDialog.getResultSending();var obj=$.extend(true,{},data);obj.resultCode=resultSending.resultCode;obj.msg=resultSending.msg;var array=resultSending.unitErrors.concat(obj.unitErrors);obj.unitErrors=array;return obj},removeResultSending:function(){var resultSending={};this.labelDialog.setResultSending(resultSending)},displayErrDialog:function(data){this.setMsgData(data);var message="DisplayErrDialog#display";this.labelDialog.broadcast(message)},displaySysErrDialog:function(){var self=this;
return function(xhr,status,error){var message="DisplayErrDialog#dispSysErr";self.labelDialog.broadcast(message)}}};
